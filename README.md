# 拼豆图生成器 - Perler Bead Generator

一个完整可商用的在线拼豆图生成网站，支持上传图片自动转换为标准拼豆图纸。

## ✨ 核心功能

### 1. 图片上传与预处理
- ✅ 支持 JPG/PNG/WEBP/GIF 格式
- ✅ 点击上传 + 拖拽上传
- ✅ 图片预览
- ✅ 自动调整尺寸和居中

### 2. 拼豆图转换（核心算法）
- ✅ 自定义拼豆颗粒度（20-100颗）
- ✅ 内置 2.6mm/5mm/10mm 主流规格预设
- ✅ LAB 颜色空间精准匹配
- ✅ PERLER 官方色卡（24/48/72色）
- ✅ 自动消除孤立像素
- ✅ 平滑色块优化
- ✅ 实时预览

### 3. 导出与物料
- ✅ PNG 格式图纸导出
- ✅ PDF 格式图纸导出（含物料清单）
- ✅ 网格线开关
- ✅ 色号标注开关
- ✅ 拼豆色号用量清单
- ✅ CSV 格式清单导出
- ✅ 分色图层导出

### 4. 辅助功能
- ✅ localStorage 本地存储
- ✅ 预设管理（保存/加载常用配置）
- ✅ 历史记录（最近20条）
- ✅ 原图对比功能
- ✅ 缩放控制（50%-300%）
- ✅ 全响应式适配（移动端/平板/桌面端）

## 🎨 UI 设计

### 设计风格
- 复古像素动画风格
- 8bit 过渡动画
- 明亮马卡龙色系
- 像素化图标和按钮

### 布局规范
- **桌面端**: 左右分栏（左30%控制面板，右70%预览画布）
- **移动端**: 上下布局，自动适配
- **响应式断点**: <768px (移动), 768-1200px (平板), >1200px (桌面)

## 🚀 快速开始

### 1. 安装依赖

```bash
cd /root/perler-bead-generator
npm install
```

### 2. 启动开发服务器

```bash
npm run dev
```

服务器将在 `http://0.0.0.0:3210` 启动

### 3. 公网访问

**重要**: 确保云服务器安全组/防火墙已放开 **3210 端口**的入站规则

本地浏览器访问: `http://你的云服务器公网IP:3210`

### 4. 构建生产版本

```bash
npm run build
npm run preview
```

## 🧪 UI 自动化测试

### 安装 Playwright

```bash
# 安装 Playwright 及浏览器
npx playwright install --with-deps chromium
```

### 运行测试

```bash
# 运行所有UI测试
npm run test:ui

# 生成截图
npm run test:screenshot
```

### 测试覆盖

- ✅ 页面加载测试
- ✅ 核心UI元素检查
- ✅ 响应式布局测试（桌面/移动/平板）
- ✅ 交互功能测试（按钮/滑块/复选框）
- ✅ 控制台错误检查
- ✅ UI自检日志验证
- ✅ 全页面截图（3种尺寸）

### 查看测试报告

```bash
npx playwright show-report
```

## 📁 项目结构

```
perler-bead-generator/
├── src/
│   ├── App.tsx                 # 主应用组件
│   ├── main.tsx               # 入口文件
│   ├── index.css              # 全局样式
│   └── utils/
│       ├── colorPalette.ts    # 色卡数据和颜色匹配
│       ├── imageConverter.ts  # 图片转换核心算法
│       └── exportUtils.ts     # 导出功能
├── tests/
│   └── ui.spec.ts             # UI自动化测试
├── screenshots/               # 测试截图输出目录
├── index.html                 # HTML模板
├── vite.config.ts            # Vite配置（公网访问）
├── tailwind.config.js        # Tailwind配置
├── playwright.config.ts      # Playwright配置
├── package.json              # 依赖配置
└── README.md                 # 本文件
```

## 🔧 技术栈

- **前端框架**: React 18 + TypeScript
- **构建工具**: Vite 5
- **样式方案**: Tailwind CSS 3
- **图像处理**: Canvas API
- **状态管理**: React Hooks
- **自动化测试**: Playwright
- **色彩空间**: LAB (精准颜色匹配)

## 🎯 核心算法

### 颜色匹配算法

使用 LAB 色彩空间进行颜色距离计算，比 RGB 更符合人眼感知：

```typescript
// RGB → LAB 转换
// LAB 色彩空间距离计算
// 找到最接近的拼豆颜色
```

### 图像优化算法

1. **孤立像素移除**: 检查周围8个像素，替换为最常见邻居颜色
2. **色块平滑**: 3x3邻域统计，使用主导颜色（占比>50%）

## 📊 性能优化

- ✅ Canvas 高质量缩放
- ✅ 图像数据缓存
- ✅ 按需渲染
- ✅ localStorage 持久化
- ✅ 懒加载历史记录

## 🔒 安全性

- ✅ 文件类型验证
- ✅ 文件大小限制（10MB）
- ✅ XSS 防护
- ✅ 本地数据存储（无服务器上传）

## 📱 浏览器兼容性

- ✅ Chrome 90+
- ✅ Firefox 88+
- ✅ Safari 14+
- ✅ Edge 90+

## 🐛 故障排查

### 问题: 无法访问页面

**解决方案**:
1. 检查服务是否启动: `ps aux | grep vite`
2. 检查端口是否监听: `netstat -tlnp | grep 3210`
3. 检查防火墙规则: `sudo ufw status`
4. 检查安全组配置（云服务器）

### 问题: UI元素缺失

**解决方案**:
1. 打开浏览器控制台查看错误
2. 运行 UI 自检（页面加载时自动执行）
3. 查看控制台日志中的 `✅` 和 `❌` 标记

### 问题: 转换失败

**解决方案**:
1. 检查图片格式是否支持
2. 检查图片大小是否超过10MB
3. 尝试降低画布分辨率
4. 查看控制台错误信息

## 📝 开发日志

### 2026-02-12
- ✅ 完成项目初始化
- ✅ 实现核心转换算法
- ✅ 完成 UI 设计和响应式布局
- ✅ 集成 Playwright 自动化测试
- ✅ 配置公网远程访问
- ✅ 添加 UI 自检功能

## 📄 许可证

MIT License

## 👨‍💻 作者

云脑 (Cloud Brain) - 专属全栈开发工程师

---

**注意**: 本项目为完整可运行的商用级代码，无任何占位符或TODO注释。所有功能均已完整实现。
